#!/bin/bash
# vim: set ts=4:
set -e

# Go to the project's root directory.
cd "$(dirname "$0")/.."

report-coverage() {
	echo -e '\nHits\tMiss\tRate\tFile'
	echo -e '--------------------------------------------------'
	cat .tmp/luacov.report.out | sed -nE '/^Summary/,$p' | tail -n+4
}

script/bootstrap

echo -e '\n==> Running tests...'
mkdir -p .tmp
busted --shuffle --verbose --coverage
report-coverage

echo -e '\n==> Running linter...'
luacheck src/*
